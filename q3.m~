load ps5_data.mat
load snippets

THRESHOLD = 1000;
mean_vectors = InitTwoClusters_1;

NUM_OF_CLUSTERS = size(mean_vectors, 2);
DIMENSIONALITY = size(mean_vectors, 1);
NUM_OF_POINTS = size(snippets, 2);

r = zeros(NUM_OF_CLUSTERS, NUM_OF_POINTS);

J = [];

iter_count = 0;
while(1)
    iter_count = iter_count + 1;
    % E Step
    dist = pdist2(mean_vectors', snippets');
    for j=1:NUM_OF_CLUSTERS
        r(j, :) = dist(j, :) == min(dist);
    end


    % M Step
    for i=1:NUM_OF_CLUSTERS
        numer = zeros(DIMENSIONALITY, 1);
        denom = 0;
        for j=1:NUM_OF_POINTS
            numer = numer + snippets(:, j).*r(i,j);
            denom = denom + r(i, j);
        end
        mean_vectors(:, i) = numer ./ denom;
    end

    % Computing J
    J_iter = 0;
    for i=1:NUM_OF_POINTS
        for j=1:NUM_OF_CLUSTERS
            J_iter = J_iter + norm(snippets(:,i) - mean_vectors(:,j)) .* r(j, i);
        end
    end
    J = [J;J_iter];
    if iter_couJ_iter < J(iter_count - 1)
        break;
    end
end